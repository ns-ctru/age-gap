---
title: Survival and Deaths in the Bridging The Age Gap Study
output: html
bibliography: ../sections/bibliography.bib
---

```{r setup, echo = FALSE, warning = FALSE, message = FALSE, results = 'hide', cache = FALSE, eval = TRUE}
library(agegap)
##opts_chunk$set(dev = 'pdf')
opts_chunk$set(cache.path = 'cache/',
               width    = 200,
               fig.height = 8,
               fig.width  = 8,
               warning = FALSE,
               message = FALSE)
options(digits = 3,
        imputations = 5)
## Ensure anchors are assessed first
## opts_knit$set(eval.after = 'echo')
## Hooks
## knit_hooks$set(anchor = hook_anchor)
## Set a seed
set.seed(69027181)
## Set sensible defaults
ggplot2.opts <- list()
ggplot2.opts$binwidth <- 30
## Exclusions
##
## The following 'non-recruited' need excluding from all analyses
## exclusions <- c()

```

# Introduction

As of writing the planned five year survival data from [NHS Digital](https://digital.nhs.uk/).  The [Bridging the Age Gap](https://www.sheffield.ac.uk/oncology-metabolism/research/surgicaloncology/research/agegap) Chief Investigator, [Lynda Wyld](mailto:l.wyld@sheffield.ac.uk) wrote to Terry Hill (NHS Digital Data Dissemination Director) who sits on the [Research Advisory Group](https://digital.nhs.uk/research-advisory-group) on 2017-10-23 to appeal the decision by NHS Digital to refuse access to the data.  As of writing `r date()` no response has been seen the the author.

This means the primary outcome of the cohort study, comparing five-year survival rates between different primary treatment groups, is somewhat problematic.  Possible options include...

* Using two-year survival rates captured on the Study Completion and Discontinuation Case Report Forms.
* Returning to centers and reviewing all case notes for participants to obtain data on survivorship at five-year follow-up.

The later option will take considerable time and the data is not currently available.  In the mean time the available Study Completion data has been investigated to look at its utility for answering the question of how two-year survival rates compare between different primary treatment arms.

**Caveat** The Case Report Forms for this study only capture accurately the dates of surgery.  Follow-ups at six-weeks, six, twelve, eighteen and 24 months whilst capturing the treatment received since last contact, do not record the date of those treatments, they are instead recorded with the date of the follow-up.  This means that it is not straight-forward to determine the primary treatment participants of the study have received.  In consultation with Lynda Wyld an algorithm for defining these has been determined but it still leaves some ~400 participants with unusual treatment profiles whose data is pending review by Lynda for classification (data was provided 2017-11-21).

## Methods

The data was extracted from the [Prospect Database](https://www.ctru-prospect.shef.ac.uk) on 2018-01-30 and data from the 54 individual text files (one for each Case Report Form (CRF)) combined in the statistical programming language [R](https://www.r-project.org/).  A number of variables are derived by Prospect for scoring the various questionnaires and further reconcilation of data recorded on both body axes (i.e. left and right side) is performed when combining the files (although since this is not the focus of the current report no further discussion will be made of this).

### Baseline Characteristics

A multitude of baseline characteristics are summarised and reported for each of the treatment groups.  No formal test for statistically significant differences between these are made as it is not recommended **TODO** Senn citation on differences at baseline?

### Primary Treatment

As alluded to in the Introduction the allocation of individuals to primary treatment has not been straight-forward.  Based on clinical knowledge of treatment pathways provided by Lynda Wyld (meeting held 2017-10-23 09:00-11:00) notes were taken a hand-sketched schematic produced (see [this document](https://docs.google.com/document/d/1xSykX3mYtWoFng3gmf05Xjk7OX5WtfqV2RyRyvvvAcs/edit?usp=sharing) pg5-6, ignore table on pg4-5 which was not completed).  These have guided the implementation of an algorithm for classifying treatment as described below.

**TODO** Fill in details based on actual code.

This led to all but 400 individuals being classified to a primary treatment group.  Data on the remaining individuals who could not be classified was provided to Lynda Wyld 2017-11-21 (see email from [n.shephard@sheffield.ac.uk](mailto:n.shephard@sheffield.ac.uk) @ 16:40 **Subject** [AGEGAP] Data for review).  After review by Lynda these were allocated to a primary treatment and the allocation incorporated into the main dataset.  **NB** If this is not available then such individuals will in essence be excluded from all analyses as they can not unequivocally be allocated to a primary treatment group, although the option to include them as a group of their own under the category of `Other` exists.

### Death Follow-up

The following fields from the `Study Completion and Discontinuation Form` CRF are merged into the combined data set.  The date on which the `Study Completion and Discontinuation Form `is completed is required because it does not always align with the two-year follow-up (see results).

| Field      | Description       |
|:-----------|:------------------|
| `study_completiong_dt`        | Date Study Completion form completed. Date not always on 24 month follow-up, even if study completed.    |
| `disc_rsn` | Reason for discontinuation. |
| `disc_death_dt` | Date of death if participant died. |
| `death_cause_1` | Primary cause of death. |
| `death_cause_2` | Secondary cause of death. |
| `death_cause_3` | Tertiary cause of death. |

#### Comparison of Survival

[Kaplan-Meier]() plots will be generated to provide a graphical overview and crude unadjusted estimate of survivorship by treatment allocation.

## Results

### Baseline Characteristics


### Primary Treatment Classification


### Death Follow-up

As full five-year follow-up is not currently available the `Study Completion and Discontinuation Form` is being used as a proxy for the time being.  This is, unless a participant withdraws early, meant to be completed at two year follow-up, although this is only true for a fraction of cases as shown in the figure below.

```{r results-study-completion, echo = FALSE, cache = FALSE, fig.width = 8, fig.height = 8,eval = TRUE}
## Plot the reasons for study completion/discontinuation
age_gap %>%
    ## Either replace disc_rsn with text indicating no completion data...
    mutate(`Last Contact Type` = ifelse(!is.na(disc_rsn),
                                        yes = as.character(disc_rsn),
                                        no  = "No Completion, date last seen.")) %>%
    ## ...or remove those individuals who don't have it.
    ## dplyr::filter(!is.na(disc_rsn)) %>%
##ggplot(, aes(as.numeric(survival), colour = disc_rsn)) +
    ggplot(aes(as.numeric(survival),
               colour = `Last Contact Type`,
               fill   = `Last Contact Type`)) +
    geom_histogram(bins = 80, position = "stack") +
    ## annotate("432",
    ##          x = 0, y = 432) +
    xlab("Days") +
    ylab("N") +
    ggtitle("Survival by Event Date") +
    ## facet_wrap(~event_name, ncol = 1) +
    facet_grid(`Last Contact Type`~event_name, scales = "free") +
    ## ToDo - Sort out legend title
    ## scale_fill_colour(name = "Last Contact Type") +
    ## theme(legend.text = "Last Contact") +
    theme_bw()

```
