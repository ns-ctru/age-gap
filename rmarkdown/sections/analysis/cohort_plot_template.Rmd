```{r analysis_cohort_plot_template, echo = FALSE, warning = FALSE, message = FALSE, results = 'hide', cache = FALSE, eval = TRUE}
###################################################################################
## Graphical Summaries                                                           ##
###################################################################################
## Create a list of plots, each item being a particular form
## ToDo - Not perfect, currently the interal plotting isn't quite right so the
##        returned data frame is for now being used to plot, once thats corrected
##        the returned plot will be printable directly (code is in place for when
##        working)

## Initialise a list
cohort_plot_template <- list()
## EQ5D
cohort_plot_template$eq5d <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
                                       id               = individual_id,
                                       select           = c(mobility,
                                                            self_care,
                                                            usual_activity,
                                                            pain_discomfort,
                                                            anxiety_depression,
                                                            eq5d_score),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('None', 'Slight', 'Moderate', 'Severe', 'Extreme'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of EQ-5D-5L scores over time',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)

## EORTC-QLQ-C30
cohort_plot_template$eortc_qlq_c30 <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
                                       id               = individual_id,
                                       select           = c(c30_q1, c30_q2, c30_q3, c30_q4, c30_q5,
                                                            c30_q6, c30_q7, c30_q8, c30_q9, c30_q10,
                                                            c30_q11, c30_q12, c30_q13, c30_q14, c30_q15,
                                                            c30_q16, c30_q17, c30_q18, c30_q19, c30_q20,
                                                            c30_q21, c30_q22, c30_q23, c30_q24, c30_q25,
                                                            c30_q26, c30_q27, c30_q28, ## , c30_q29, c30_q30,
                                                            ql_raw, ql_scale,
                                                            pf_raw, pf_scale,
                                                            rf_raw, rf_scale,
                                                            ef_raw, ef_scale,
                                                            cf_raw, cf_scale,
                                                            sf_raw, sf_scale,
                                                            fa_raw, fa_scale,
                                                            nv_raw, nv_scale,
                                                            pa_raw, pa_scale,
                                                            dy_scale,
                                                            sl_scale,
                                                            ap_scale,
                                                            co_scale,
                                                            di_scale,
                                                            fi_scale),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('Not at All', 'A Little', 'Quite a Bit', 'Very Much'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of EORTC Quality of Life Questionnaires (C30) scores over time',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)
## EORTC-QLQ-BR23
cohort_plot_template$eortc_qlq_br23 <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
                                       id               = individual_id,
                                       select           = c(br23_q31, br23_q32, br23_q33, br23_q34, br23_q35,
                                                            br23_q36, br23_q37, br23_q38, br23_q39, br23_q40,
                                                            br23_q41, br23_q42, br23_q43, br23_q44, br23_q45,
                                                            br23_q46, br23_q47, br23_q48, br23_q49, br23_q50,
                                                            br23_q51, br23_q52, br23_q53,
                                                            brbi_raw, brbi_scale,
                                                            brsef_raw, brsef_scale,
                                                            brsee_scale, brfu_scale,
                                                            brst_raw, brst_scale,
                                                            brbs_raw, brbs_scale,
                                                            bras_raw, bras_scale,
                                                            brhl_scale),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('Not at All', 'A Little', 'Quite a Bit', 'Very Much'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of EORTC Quality of Life Questionnaires (BR23) scores over time',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)
## EORTC-QLQ-ELD15
cohort_plot_template$eortc_qlq_eld15 <- ctru::plot_summary(df    = age_gap,
                                       id               = individual_id,
                                       select           = c(eld15_q54, eld15_q55, eld15_q56, eld15_q57, eld15_q58,
                                                            eld15_q59, eld15_q60, eld15_q61, eld15_q62, eld15_q63,
                                                            eld15_q64, eld15_q65, eld15_q66, eld15_q67, eld15_q68,
                                                            mo_raw, mo_scale,
                                                            wao_raw, wao_scale,
                                                            wo_raw, wo_scale,
                                                            mp_raw, mp_scale,
                                                            boi_raw, boi_scale,
                                                            js_scale,
                                                            fs_scale),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('Not at All', 'A Little', 'Quite a Bit', 'Very Much'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of EORTC Quality of Life Questionnaires (ELD15) scores over time',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)
## Therapy Assessment
cohort_plot_template$therapy_assessment <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
                                       id               = individual_id,
                                       select           = c(any_treatment,
                                                            endocrine_therapy,
                                                            radiotherapy,
                                                            chemotherapy,
                                                            trastuzumab,
                                                            surgery,
                                                            treatment_profile),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('No', 'Yes'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of Therapy Assessment',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)
## Endocrine Therapy
cohort_plot_template$endocrine_therapy <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
                                       id               = individual_id,
                                       select           = c(et_hot_flushes,
                                                            et_asthenia,
                                                            et_joint_pain,
                                                            et_vaginal_dryness,
                                                            et_hair_thinning,
                                                            et_rash,
                                                            et_nausea,
                                                            et_diarrhoea,
                                                            et_headache,
                                                            et_vaginal_bleeding,
                                                            et_vomiting,
                                                            et_somnolence),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('No', 'Yes'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of Endocrine Therapy',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)
## Radiotherapy
cohort_plot_template$radiotherapy <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
                                       id               = individual_id,
                                       select           = c(## which_breast_right,
                                                            ## which_breast_left,
                                                            r_site_breast,
                                                            r_site_axilla,
                                                            r_site_supraclavicular,
                                                            r_site_chest_wall,
                                                            r_site_other,
                                                            ## r_breast_fractions,
                                                            ## r_axilla_fractions,
                                                            ## r_supra_fractions,
                                                            ## r_chest_fractions,
                                                            ## r_orther_fractions,
                                                            r_radiotherapy_aes,
                                                            l_site_breast,
                                                            l_site_axilla,
                                                            l_site_supraclavicular,
                                                            l_site_chest_wall,
                                                            l_site_other,
                                                            ## l_breast_fractions,
                                                            ## l_axilla_fractions,
                                                            ## l_supra_fractions,
                                                            ## l_chest_fractions,
                                                            ## l_other_fractions,
                                                            l_radiotherapy_aes,
                                                            r_skin_erythema,
                                                            r_pain,
                                                            r_breast_oedema,
                                                            r_breast_shrink,
                                                            r_breast_pain,
                                                            l_skin_erythema,
                                                            l_pain,
                                                            l_breast_oedema,
                                                            l_breast_shrink,
                                                            l_breast_pain),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('No', 'Yes'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of Radiotherapy',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)
## Chemotherapy
cohort_plot_template$chemotherapy <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
                                       id               = individual_id,
                                       select           = c(chemo_received,
                                                            chemo_aes,
                                                            c_fatigue,
                                                            c_anaemia,
                                                            c_low_wc_count,
                                                            c_thrombocytopenia,
                                                            c_allergic,
                                                            c_hair_thinning,
                                                            c_nausea,
                                                            c_infection),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('No', 'Yes'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of Chemotherapy',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)
## Trastuzumab
cohort_plot_template$trastuzumab <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
                                       id               = individual_id,
                                       select           = c(trast_aes,
                                                            t_cardiac_fail,
                                                            t_flu_like,
                                                            t_nausea,
                                                            t_diarrhoea,
                                                            t_headache,
                                                            t_allergy),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('No', 'Yes'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of Trastuzumab',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)
## Surgery
## cohort_plot_template$surgery <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
##                                        id               = individual_id,
##                                        select           = c(which_breast_right,
##                                                             which_breast_left,
##                                                             r_surgery_type,
##                                                             r_mastectomy_spcfy,
##                                                             r_surgery_type_oth,
##                                                             r_axillary_type,
##                                                             r_surgery_aes_acute,
##                                                             r_sa_haemorrhage,
##                                                             r_sa_seroma,
##                                                             r_sa_haematoma,
##                                                             r_sa_infection,
##                                                             r_sa_necrosis,
##                                                             r_sa_wound,
##                                                             r_surgery_aes_chronic,
##                                                             r_sc_wound_pain,
##                                                             r_sc_functional_diff,
##                                                             r_sc_neuropathy,
##                                                             r_sc_lymphoedema,
##                                                             l_surgery_type,
##                                                             l_mastectomy_spcfy,
##                                                             l_surgery_type_oth,
##                                                             l_axillary_type,
##                                                             l_surgery_aes_acute,
##                                                             l_sa_haemorrhage,
##                                                             l_sa_seroma,
##                                                             l_sa_haematoma,
##                                                             l_sa_infection,
##                                                             l_sa_necrosis,
##                                                             l_sa_wound,
##                                                             l_surgery_aes_chronic,
##                                                             l_sc_wound_pain,
##                                                             l_sc_functional_diff,
##                                                             l_sc_neuropathy,
##                                                             l_sc_lymphoedema,
##                                                             surgery_aes_acute_gen,
##                                                             sa_somnolence,
##                                                             sa_allergic,
##                                                             sa_arrhythmia,
##                                                             sa_dvt_embolism,
##                                                             sa_infarction,
##                                                             sa_stroke,
##                                                             sa_atelectasis,
##                                                             assessment_dt,
##                                                             r_histopathology_no,
##                                                             r_tumour_size,
##                                                             r_allred,
##                                                             r_h_score,
##                                                             r_her_2_score,
##                                                             r_onco_offered,
##                                                             r_onco_used,
##                                                             r_risk_score,
##                                                             r_tumour_type,
##                                                             r_tumour_type_spcfy,
##                                                             r_tumour_grade,
##                                                             r_margins_clear,
##                                                             r_margin,
##                                                             r_designation_anterior,
##                                                             r_designation_posterior,
##                                                             r_designation_lateral,
##                                                             r_designation_medial,
##                                                             r_designation_superior,
##                                                             r_designation_inferior,
##                                                             r_close_margin,
##                                                             r_nodes_excised,
##                                                             r_nodes_involved,
##                                                             l_histopathology_no,
##                                                             l_tumour_size,
##                                                             l_allred,
##                                                             l_h_score,
##                                                             l_her_2_score,
##                                                             l_onco_offered,
##                                                             l_onco_used,
##                                                             l_risk_score,
##                                                             l_tumour_type,
##                                                             l_tumour_type_spcfy,
##                                                             l_tumour_grade,
##                                                             l_margins_clear,
##                                                             l_margin,
##                                                             l_designation_anterior,
##                                                             l_designation_posterior,
##                                                             l_designation_lateral,
##                                                             l_designation_medial,
##                                                             l_designation_superior,
##                                                             l_designation_inferior,
##                                                             l_close_margin,
##                                                             l_nodes_excised,
##                                                             l_nodes_involved),
##                                        lookup_fields    = master$lookups_fields,
##                                        levels_factor    = c('No', 'Yes'),
##                                        group            = template,
##                                        events           = event_name,
##                                        theme            = theme_bw(),
##                                        position         = 'identity',
##                                        histogram        = TRUE,
##                                        boxplot          = TRUE,
##                                        individual       = TRUE,
##                                        plotly           = FALSE,
##                                        remove_na        = TRUE,
##                                        title_factor     = 'Summary of Surgery',
##                                        title_continuous = NULL,
##                                        legend_continuous = FALSE,
##                                        legend_factor    = TRUE)
## #
# Clinical Assessment PET
cohort_plot_template$clinical_assessment_pet <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
                                       id               = individual_id,
                                       select           = c(## uni_bilateral,
                                                            ## primary_tumour,
                                                            ## r_focal,
                                                            ## r_num_tumours,
                                                            r_cancer_palpable_pet,
                                                            ## r_size_clin_assess_pet,
                                                            r_method_assess_pet,
                                                            ## r_size_ultrasound_pet,
                                                            ## r_size_mammo_pet,
                                                            r_axillary_present_pet,
                                                            ## r_axillary_nodes_pet,
                                                            ## r_axillary_axis_pet,
                                                            ## l_focal,
                                                            ## l_num_tumours_pet,
                                                            l_cancer_palpable_pet,
                                                            ## l_size_clin_assess_pet,
                                                            l_method_assess_pet,
                                                            ## l_size_ultrasound_pet,
                                                            ## l_size_mammo_pet,
                                                            l_axillary_present_pet,
                                                            ## l_axillary_nodes_pet,
                                                            ## l_axillary_axis_pet,
                                                            metastatic,
                                                            metastatic_where_bone,
                                                            metastatic_where_lung,
                                                            metastatic_where_cervical_node,
                                                            metastatic_where_other,
                                                            metastatic_where_liver,
                                                            metastatic_where_brain,
                                                            ## proposed_treat,
                                                            ## clinical_plan2,
                                                            plan_change_surgery,
                                                            plan_change_radio,
                                                            plan_change_antioestrogen,
                                                            plan_change_other), ##,
                                                            ## plan_change_spcfy),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('Not Ticked', 'Ticked'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of Clinical Assessment (PET)',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)
## Clinical Assessment Non PET
cohort_plot_template$clinical_assessment_non_pet <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
                                       id               = individual_id,
                                       select           = c(recurrence_where_breast,
                                                            recurrence_where_chest_wall,
                                                            recurrence_where_axilla,
                                                            recurrence_where_metastatic,
                                                            recurrence_met_bone,
                                                            recurrence_met_liver,
                                                            recurrence_met_lung,
                                                            recurrence_met_superclavicular,
                                                            recurrence_met_brain,
                                                            recurrence_met_other,
                                                            ## recurrence_met_spcfy,
                                                            new_tumour_yn,
                                                            ## new_tumour_dtls,
                                                            ## clinical_plan,
                                                            plan_local_surgery,
                                                            plan_local_radio,
                                                            plan_local_endocrine,
                                                            plan_local_chemo,
                                                            plan_local_trast,
                                                            plan_local_other,
                                                            ## plan_local_spcfy,
                                                            plan_met_radio,
                                                            plan_met_endocrine,
                                                            plan_met_chemo,
                                                            plan_met_trast,
                                                            plan_met_other,
                                                            ## plan_met_spcfy,
                                                            plan_routine_surgery,
                                                            plan_routine_radio,
                                                            plan_routine_endocrine,
                                                            plan_routine_chemo,
                                                            plan_routine_trast,
                                                            plan_routine_other), ## ,
                                                            ## plan_routine_spcfy),
                                       lookup_fields    = master$lookups_fields,
                                       levels_factor    = c('Not Ticked', 'Ticked'),
                                       group            = template,
                                       events           = event_name,
                                       theme            = theme_bw(),
                                       position         = 'identity',
                                       histogram        = TRUE,
                                       boxplot          = TRUE,
                                       individual       = TRUE,
                                       plotly           = FALSE,
                                       remove_na        = TRUE,
                                       title_factor     = 'Summary of Clinical Assessment (Non-PET)',
                                       title_continuous = NULL,
                                       legend_continuous = FALSE,
                                       legend_factor    = TRUE)

## All continuous variables
numeric_vars <- which(sapply(age_gap, is.numeric)) %>% names()
## cohort_plot_template$continuous <- age_gap %>%
                                 dplyr::filter(!is.na(template)) %>%
                                 ctru::plot_summary(df            = age_gap,
##                                              id               = individual_id,
##                                              select           = numeric_vars,
##                                              lookup_fields    = master$lookups_fields,
##                                              levels_factor    = NULL,
##                                              group            = template,
##                                              events           = event_name,
##                                              theme            = theme_bw(),
##                                              position         = 'identity',
##                                              histogram        = TRUE,
##                                              boxplot          = TRUE,
##                                              individual       = TRUE,
##                                              plotly           = FALSE,
##                                              remove_na        = TRUE,
##                                              title_factor     = NULL,
##                                              title_continuous = NULL,
##                                              legend_continuous = FALSE,
##                                              legend_factor    = TRUE)
## Save plots
save(cohort_plot_template,
     file = 'data/cohort_plot_template.RData')


```
