---
site: blogdown:::blogdown_site
---

```{r methods_load, echo = FALSE, warning = FALSE, message = FALSE, results = 'hide', cache = FALSE, eval = TRUE}
load('~/work/scharr/age-gap/lib/data/age-gap.RData')

```

# Overview

The Cluster Randomised Control Trial (cRCT) component of the study is the main focus of the work and results presented here.  The Cohort study is analysed seperately by another statistician (originally assigned to Oscar Bortolami, but he has since left the CTRU and its unclear who is conducting these analyses), however as the Quality Control (QC) statistician assigned to check the analyses of the Cohort study a portion of that QC process is presented within.

Detailed guidelines of the work required for both studies is provided in two Statistical Analysis Plans written by Oscar Bortolami and approved by the senior statistician [Stephen Walters](mailto:s.j.walters@sheffield.ac.uk) and chief investigator [Lynda Wyld](mailto:l.wyld@sheffield.ac.uk).  These are not (yet) available online...

* Bridging The Age Gap Cohort Statistical Analysis Plan v1.1 2017-02-02
* Bridging The Age Gap cRCT Statistical Analysis Plan v4 2017-02-02


## Cluster Randomised Control Trial


## QC of Cohort Study

Summary tables of the number of missing observations, mean, standard deviation (SD), minimum, maximum, median and inter-quartile range for demographic data and the responses to each of the surveys by treatment arm and overall will be provided for each time point assessments were made.  The Statistical Analysis Plan (SAP) is not prescriptive about what exactly is to be checked so an *ad hoc* approach is taken whereby the author checks what they think is important and then updates this as and when defficiencies are highlighted.

```{r methods_cohort_plot, echo = FALSE, warning = FALSE, message = FALSE, results = 'hide', cache = FALSE, eval = TRUE}
## Create a list of plots, each item being a particular form
## ToDo - Not perfect, currently the interal plotting isn't quite right so the
##        returned data frame is for now being used to plot, once thats corrected
##        the returned plot will be printable directly (code is in place for when
##        working)

## Initialise a list
cohort_plot <- list()
## EQ5D
cohort_plot$eq5d <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(mobility, self_care, usual_activity, pain_discomfort, anxiety_depression),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('None', 'Slight', 'Moderate', 'Severe', 'Extreme'),
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of EQ-5D-5L scores over time',
                                       title_continuous = NULL)
## EORTC-QLQ-C30
cohort_plot$eortc_qlq_c30 <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(c30_q1, c30_q2, c30_q3, c30_q4, c30_q5,
                                                         c30_q6, c30_q7, c30_q8, c30_q9, c30_q10,
                                                         c30_q11, c30_q12, c30_q13, c30_q14, c30_q15,
                                                         c30_q16, c30_q17, c30_q18, c30_q19, c30_q20,
                                                         c30_q21, c30_q22, c30_q23, c30_q24, c30_q25,
                                                         c30_q26, c30_q27, c30_q28), ## , c30_q29, c30_q30,
                                                         ## ql_raw, ql_scale, pf_raw, pf_scale, rf_raw, rf_scale,
                                                         ## ef_raw,ef_scale, cf_raw,cf_scale, sf_raw, sf_scale,
                                                         ## fa_raw,fa_scale, nv_raw,nv_scale, pa_raw, pa_scale,
                                                         ## dy_scale, sl_scale, ap_scale, co_scale, di_scale, fi_scale),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('Not at All', 'A Little', 'Quite a Bit', 'Very Much'),
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of EORTC Quality of Life Questionnaires (C30) scores over time',
                                       title_continuous = NULL)
## EORTC-QLQ-BR23
cohort_plot$eortc_qlq_br23 <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(br23_q31, br23_q32, br23_q33, br23_q34, br23_q35,
                                                         br23_q36, br23_q37, br23_q38, br23_q39, br23_q40,
                                                         br23_q41, br23_q42, br23_q43, br23_q44, br23_q45,
                                                         br23_q46, br23_q47, br23_q48, br23_q49, br23_q50,
                                                         br23_q51, br23_q52, br23_q53), ## ,
                                                         ## brbi_raw, brbi_scale, brsef_raw, brsef_scale,
                                                         ## brsee_scale, brfu_scale, brst_raw, brst_scale,
                                                         ## brbs_raw, brbs_scale, bras_raw, bras_scale, brhl_scale),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('Not at All', 'A Little', 'Quite a Bit', 'Very Much'),
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of EORTC Quality of Life Questionnaires (BR23) scores over time',
                                       title_continuous = NULL)
## EORTC-QLQ-ELD15
cohort_plot$eortc_qlq_eld15 <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(eld15_q54, eld15_q55, eld15_q56, eld15_q57, eld15_q58,
                                                         eld15_q59, eld15_q60, eld15_q61, eld15_q62, eld15_q63,
                                                         eld15_q64, eld15_q65, eld15_q66, eld15_q67, eld15_q68),
                                                         ## , mo_raw, mo_scale,
                                                         ## wao_raw, wao_scale, wo_raw, wo_scale, mp_raw, mp_scale,
                                                         ## boi_raw, boi_scale, js_scale, fs_scale),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('Not at All', 'A Little', 'Quite a Bit', 'Very Much'),
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of EORTC Quality of Life Questionnaires (ELD15) scores over time',
                                       title_continuous = NULL)
## Therapy Assessment
cohort_plot$therapy_assessment <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(any_treatment,
                                                         endocrine_therapy,
                                                         radiotherapy,
                                                         chemotherapy,
                                                         trastuzumab,
                                                         surgery),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('No', 'Yes'),
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of Therapy Assessment over time',
                                       title_continuous = NULL)
## Endocrine Therapy
cohort_plot$endocrine_therapy <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(et_hot_flushes,
                                                         et_asthenia,
                                                         et_joint_pain,
                                                         et_vaginal_dryness,
                                                         et_hair_thinning,
                                                         et_rash,
                                                         et_nausea,
                                                         et_diarrhoea,
                                                         et_headache,
                                                         et_vaginal_bleeding,
                                                         et_vomiting,
                                                         et_somnolence),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('No', 'Yes'),
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of Endocrine Therapy over time',
                                       title_continuous = NULL)
## Radiotherapy
cohort_plot$radiotherapy <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(## which_breast_right_o,
                                                         ## which_breast_left_o,
                                                         r_site_breast_o,
                                                         r_site_axilla_o,
                                                         r_site_supraclavicular_o,
                                                         r_site_chest_wall_o,
                                                         r_site_other_o,
                                                         ## r_breast_fractions,
                                                         ## r_axilla_fractions,
                                                         ## r_supra_fractions,
                                                         ## r_chest_fractions,
                                                         ## r_other_fractions,
                                                         r_radiotherapy_aes,
                                                         l_site_breast_o,
                                                         l_site_axilla_o,
                                                         l_site_supraclavicular_o,
                                                         l_site_chest_wall_o,
                                                         l_site_other_o,
                                                         ## l_breast_fractions,
                                                         ## l_axilla_fractions,
                                                         ## l_supra_fractions,
                                                         ## l_chest_fractions,
                                                         ## l_other_fractions,
                                                         l_radiotherapy_aes,
                                                         r_skin_erythema,
                                                         r_pain,
                                                         r_breast_oedema,
                                                         r_breast_shrink,
                                                         r_breast_pain,
                                                         l_skin_erythema,
                                                         l_pain,
                                                         l_breast_oedema,
                                                         l_breast_shrink,
                                                         l_breast_pain),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('No', 'Yes'),
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of Radiotherapy over time',
                                       title_continuous = NULL)
## Chemotherapy
cohort_plot$chemotherapy <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(chemo_received,
                                                         chemo_aes,
                                                         c_fatigue,
                                                         c_anaemia,
                                                         c_low_wc_count,
                                                         c_thrombocytopenia,
                                                         c_allergic,
                                                         c_hair_thinning,
                                                         c_nausea,
                                                         c_infection),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('No', 'Yes'),
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of Chemotherapy over time',
                                       title_continuous = NULL)
## Trastuzumab
cohort_plot$trastuzumab <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(trast_aes,
                                                         t_cardiac_fail,
                                                         t_flu_like,
                                                         t_nausea,
                                                         t_diarrhoea,
                                                         t_headache,
                                                         t_allergy),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('No', 'Yes'),
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of Trastuzumab over time',
                                       title_continuous = NULL)
## Clinical Assessment PET
cohort_plot$clinical_assessment_pet <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(uni_bilateral,
                                                         primary_tumour,
                                                         r_focal,
                                                         ## r_num_tumours,
                                                         r_cancer_palpable,
                                                         ## r_size_clin_assess,
                                                         ## r_method_assess,
                                                         ## r_size_ultrasound,
                                                         ## r_size_mammo,
                                                         r_axillary_present,
                                                         ## r_axillary_nodes,
                                                         ## r_axillary_axis,
                                                         l_focal,
                                                         ## l_num_tumours,
                                                         ## l_cancer_palpable,
                                                         ## l_size_clin_assess,
                                                         ## l_method_assess,
                                                         ## l_size_ultrasound,
                                                         ## l_size_mammo,
                                                         l_axillary_present,
                                                         ## l_axillary_nodes,
                                                         ## l_axillary_axis,
                                                         metastatic,
                                                         metastatic_where_bone_o,
                                                         metastatic_where_lung_o,
                                                         metastatic_where_cervical_node_o,
                                                         metastatic_where_other_o,
                                                         metastatic_where_liver_o,
                                                         metastatic_where_brain_o,
                                                         ## proposed_treat,
                                                         ## clinical_plan2,
                                                         plan_change_surgery_o,
                                                         plan_change_radio_o,
                                                         plan_change_antioestrogen_o,
                                                         plan_change_oth_o) ##,
                                                         ## plan_change_spcfy),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('Not Ticked', 'Ticked'),
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of Clinical Assessment (PET) over time',
                                       title_continuous = NULL)
cohort_plot$clinical_assessment_non_pet <- ctru::plot_summary(df            = age_gap,
                                       id            = individual_id,
                                       select        = c(recurrence_where_breast,
                                                         recurrence_where_chest_wall,
                                                         recurrence_where_axilla,
                                                         recurrence_where_metastatic,
                                                         recurrence_met_bone,
                                                         recurrence_met_liver,
                                                         recurrence_met_lung,
                                                         recurrence_met_superclavicular,
                                                         recurrence_met_brain,
                                                         recurrence_met_other,
                                                         ## recurrence_met_spcfy,
                                                         new_tumour_yn,
                                                         ## new_tumour_dtls,
                                                         ## clinical_plan,
                                                         plan_local_surgery,
                                                         plan_local_radio,
                                                         plan_local_endocrine,
                                                         plan_local_chemo,
                                                         plan_local_trast,
                                                         plan_local_other,
                                                         ## plan_local_spcfy,
                                                         plan_met_radio,
                                                         plan_met_endocrine,
                                                         plan_met_chemo,
                                                         plan_met_trast,
                                                         plan_met_other,
                                                         ## plan_met_spcfy,
                                                         plan_routine_surgery,
                                                         plan_routine_radio,
                                                         plan_routine_endocrine,
                                                         plan_routine_chemo,
                                                         plan_routine_trast,
                                                         plan_routine_other) ## ,
                                                         ## plan_routine_spcfy),
                                       lookup_fields = master$lookups_fields,
                                       levels_factor = c('Not Ticked', 'Ticked)',
                                       group         = site,
                                       events        = event_name,
                                       theme         = theme_bw(),
                                       position      = 'identity',
                                       histogram     = TRUE,
                                       boxplot       = TRUE,
                                       individual    = TRUE,
                                       plotly        = FALSE,
                                       remove_na     = TRUE,
                                       title_factor  = 'Summary of Clinical Assessment (Non-PET) over time',
                                       title_continuous = NULL)

## All continuous variables
cohort_plot$continuous <- ctru::plot_summary(df            = age_gap,
                                             id            = individual_id,
                                             select        = c(bmi, age_exact, weight_kg, height_cm),
                                             lookup_fields = master$lookups_fields,
                                             levels_factor = NULL,
                                             group         = site,
                                             events        = event_name,
                                             theme         = theme_bw(),
                                             position      = 'identity',
                                             histogram     = TRUE,
                                             boxplot       = TRUE,
                                             individual    = TRUE,
                                             plotly        = FALSE,
                                             remove_na     = TRUE,
                                             title_factor  = NULL,
                                             title_continuous = NULL)

```
