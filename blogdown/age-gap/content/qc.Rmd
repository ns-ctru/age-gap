---
site: blogdown:::blogdown_site
---

```{r qc_start, echo = FALSE, warning = FALSE, message = FALSE, results = 'hide', cache = FALSE, eval = TRUE}
## Replace blank with missing in enrollment
master$screening_form <- master$screening_form %>%
    mutate(enrolment_no = ifelse(enrolment_no == '',
                                 yes = NA,
                                 no  = enrolment_no))
## Screening
screen_all <-  master$screening_form %>%
                group_by(event_date) %>%
                summarise(n = n()) %>%
                mutate(cumsum = cumsum(n),
                       site = 'All') %>%
                as.data.frame()
screen_site <- master$screening %>%
                group_by(site, event_date) %>%
                summarise(n = n()) %>%
                mutate(cumsum = cumsum(n)) %>%
                ungroup() %>%
                mutate(site   = gsub(' Hospital', '', site)) %>%
                as.data.frame()
screened <- rbind(screen_all, screen_site)
## Recruitment
recruit_all <-  master$screening_form %>%
                dplyr::filter(!is.na(enrolment_no)) %>%
                group_by(event_date) %>%
                summarise(n = n()) %>%
                mutate(cumsum = cumsum(n),
                       site = 'All') %>%
                as.data.frame()
recruit_site <- master$screening %>%
                dplyr::filter(!is.na(enrolment_no)) %>%
                group_by(site, event_date) %>%
                summarise(n = n()) %>%
                mutate(cumsum = cumsum(n)) %>%
                ungroup() %>%
                mutate(site   = gsub(' Hospital', '', site)) %>%
                as.data.frame()
recruited <- rbind(recruit_all, recruit_site)

screen_all_plot <- ggplot(screen_all, aes(x = event_date, y = cumsum)) +
                    geom_line() +
                    xlab('Date') + ylab('N') + ggtitle('Screenment across all Sites') +
                    theme_bw()
ggplotly(screen_all_plot)

screen_site_plot <- ggplot(screen_site,
                            aes(x = event_date,
                                y = cumsum,
                                colour = site)) +
                     geom_line() +
                     xlab('Date') + ylab('N') + ggtitle('Screenment by Site') +
                     guides(color = guide_legend(ncol = 2)) +
                     theme_bw()
## Optionally facet the plots and remove the legend
screen_site_plot <-  screen_site_plot +
                      facet_wrap(~site, ncol = 3) +
                      guides(colour = FALSE) +
                      theme(axis.text.x = element_text(angle = 90))

ggplotly(screen_site_plot)

rm(screen_all, screen_site)

```

# Quality Control

This section details checking (i.e. 'quality control')of the Case-Control component of the Bridging The Age Gap study.  Because there are a lot of components the work and presentation of the results are spread over a number of pages.
